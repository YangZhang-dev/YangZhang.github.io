import{_ as n,r as t,o,c as s,a as e,b as i,d as r,e as a}from"./app-20538318.js";const h={},p=a("<p>秒杀场景设计主要看以下三点：</p><ul><li>高可用</li><li>高性能</li><li>最终一致性</li></ul><p>秒杀场景的特点：</p><ul><li>读多写少</li><li>瞬时流量</li><li>流程简单</li></ul><p>下面就从前端到后端链路的分析和设计秒杀场景。</p><p>参考：</p>",6),d={href:"https://zhuanlan.zhihu.com/p/433618121",target:"_blank",rel:"noopener noreferrer"},c={href:"https://cloud.tencent.com/developer/article/1833184",target:"_blank",rel:"noopener noreferrer"},_={href:"https://zhuanlan.zhihu.com/p/273302387",target:"_blank",rel:"noopener noreferrer"},u={href:"https://zhuanlan.zhihu.com/p/165638059",target:"_blank",rel:"noopener noreferrer"},f=a('<h2 id="业务" tabindex="-1"><a class="header-anchor" href="#业务" aria-hidden="true">#</a> 业务</h2><p>可以适当增加参与秒杀的条件</p><h2 id="前端" tabindex="-1"><a class="header-anchor" href="#前端" aria-hidden="true">#</a> 前端</h2><ul><li>前端静态化，并搭配CDN减少服务器的压力</li><li>在尚未开始前，将button置为灰色，减少不必要的请求。</li><li>设置验证码或答题，将请求打散。</li></ul><h2 id="网关" tabindex="-1"><a class="header-anchor" href="#网关" aria-hidden="true">#</a> 网关</h2><p>对于一些高频访问的拉入黑名单中。还有一些比如在10点开抢，10点准时到达的请求，也一并拦截，因为验证码和答题不可能有那么快。</p><h2 id="后端" tabindex="-1"><a class="header-anchor" href="#后端" aria-hidden="true">#</a> 后端</h2><ul><li><p>活动预热，将热点数据提前缓存到redis中</p></li><li><p>非核心服务的降级，限流，拒绝，将非核心的业务暂时降级处理，将资源在短时间内先留给核心业务。</p></li><li><p>核心服务的限流处理，比如秒杀1000件商品，当请求量大于10000后就快速返回失败（令牌桶）。</p></li><li><p>采用redis库存预扣减。</p></li><li><p>使用消息队列异步下单。</p></li></ul><p>在后端保证数据的一致性，即超卖问题。</p><ul><li>采用分布式锁。</li><li>采用分布式事务。</li><li>在数据库减库存时加上<strong>库存数量判断</strong>，防止数据变为负数。</li><li>如果只允许抢购一单，那么需要数据库加<strong>唯一索引</strong>，防止用户重复购买。同时可以在redis中维护set，记录用户购买情况。</li></ul><p>步骤：</p><ol><li>首先将库存缓存在redis中。</li><li>当请求到达时先在redis中进行库存预扣减，当redis中库存不足时返回失败，查看Set中是否存在该用户，存在就返回失败，不存在插入返回成功，整个过程使用lua脚本保证原子性。</li><li>采用消息队列异步下单。</li><li>扣库存的时候先扣数据库库存，再扣减redis库存，保证在同一个事务里。数据库扣减库存时加入<code>where 库存 &gt; 0</code>。</li><li>客户端轮询是否下单成功。</li></ol>',12);function m(b,x){const l=t("ExternalLinkIcon");return o(),s("div",null,[p,e("p",null,[e("a",d,[i("万字超详解秒杀系统！"),r(l)])]),e("p",null,[e("a",c,[i("面试官问我：如何设计一个秒杀场景？"),r(l)])]),e("p",null,[e("a",_,[i("高频面试题：秒杀场景设计 "),r(l)])]),e("p",null,[e("a",u,[i("秒杀常见问题（超卖问题）"),r(l)])]),f])}const k=n(h,[["render",m],["__file","秒杀场景.html.vue"]]);export{k as default};
